<turbo-frame id="main_content">
  <!-- List title -->
  <h2 class="mb-4 fw-bold display-6"><%= @selected_list.name %></h2>

  <!-- Inline Add Movie Form -->
  <div class="bookmark-form-container mb-5 p-4 rounded-3 border:0 bg-secondary text-dark shadow-sm">
    <h5 class="text-uppercase text-light mb-4 fw-bold">Add a new movie to this list</h5>

    <%= simple_form_for([@selected_list, @bookmark], html: { class: "row gy-3 gx-3" }) do |f| %>
      <div class="col-12 col-md-5">
        <%= f.association :movie,
              collection: Movie.all.order(:title),
              prompt: "üé¨  Select a movie",
              label: false,
              input_html: { class: "form-select form-select-sm custom-select" } %>
      </div>

      <div class="col-12 col-md-5">
        <%= f.input :comment,
              label: false,
              placeholder: "üí≠  Add your thoughts about this movie...",
              input_html: { class: "form-control form-control-lg custom-input" } %>
      </div>

      <div class="col-12 col-md-2 d-grid">
        <%= f.submit "‚ûï Add Movie", class: "btn btn-danger btn-lg fw-bold shadow-sm" %>
      </div>
    <% end %>

    <% if @bookmark.errors.any? %>
      <div class="alert alert-danger mt-4 mb-0">
        <ul class="mb-0">
          <% @bookmark.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
  </div>


  <!-- Movies grid -->
  <% if @selected_list.bookmarks.any? %>
    <div class="row g-4">
      <% @selected_list.bookmarks.each do |bookmark| %>
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
          <div class="card h-100 bg-dark text-light shadow-sm border-0 movie-card">

            <% if bookmark.movie.poster_url.present? %>
              <img src="<%= bookmark.movie.poster_url %>"
                   class="card-img-top"
                   alt="<%= bookmark.movie.title %>">
            <% else %>
              <div class="bg-secondary d-flex align-items-center justify-content-center" style="height: 400px;">
                <span class="text-muted">No image</span>
              </div>
            <% end %>

            <div class="card-body d-flex flex-column justify-content-between">
              <div>
                <h5 class="card-title fw-bold"><%= bookmark.movie.title %></h5>
                <p class="card-text text-secondary"><%= truncate(bookmark.movie.overview, length: 100) %></p>

                <% if bookmark.comment.present? %>
                  <p class="text-muted fst-italic mt-2">‚Äú<%= bookmark.comment %>‚Äù</p>
                <% end %>
              </div>

              <% if bookmark.movie.rating.present? %>
                <div class="mt-2">
                  <span class="badge bg-danger">‚≠ê <%= bookmark.movie.rating.round(1) %></span>
                </div>
              <% end %>

              <!-- Delete bookmark -->
              <div class="mt-3">
                <%= link_to "üóë Delete",
                            bookmark_path(bookmark),
                            data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to remove this movie?" },
                            class: "btn btn-outline-light btn-sm w-100" %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-secondary">No movies in this list yet.</p>
  <% end %>
</turbo-frame>
